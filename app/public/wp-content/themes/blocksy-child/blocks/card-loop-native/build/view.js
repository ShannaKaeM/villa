(()=>{function e(e){const t={},o={};e.querySelectorAll(".filter-checkbox__input:checked").forEach((e=>{const o=e.dataset.taxonomy,n=e.dataset.term;t[o]||(t[o]=[]),t[o].push(n)})),e.querySelectorAll(".filter-range__input").forEach((e=>{const t=e.dataset.range,n=parseInt(e.value);n>0&&(o[t]=n)})),console.log("Active filters:",t),console.log("Range filters:",o);const n=new URLSearchParams({action:"filter_properties",nonce:miblocks_ajax.nonce});Object.keys(t).forEach((e=>{t[e].forEach((t=>{n.append(`filter[${e}][]`,t)}))})),Object.keys(o).forEach((e=>{n.append(`range[${e}]`,o[e])})),n.append("post_type",e.dataset.postType||"property"),n.append("posts_per_page",e.dataset.postsPerPage||"12"),n.append("card_style",e.dataset.cardStyle||"default"),n.append("columns",e.dataset.columns||"3"),console.log("AJAX params:",n.toString());const a=e.querySelector(".cards-container");a&&(a.style.opacity="0.5"),fetch(miblocks_ajax.ajax_url,{method:"POST",body:n}).then((e=>e.json())).then((t=>{if(console.log("AJAX response:",t),t.success&&a){a.innerHTML=t.data.html,a.style.opacity="1";const o=e.querySelector(".view-controls__count strong");o&&(o.textContent=t.data.found_posts)}})).catch((e=>{console.error("AJAX error:",e),a&&(a.style.opacity="1")}))}document.addEventListener("DOMContentLoaded",(()=>{console.log("Listing Section JS loaded");const t=document.querySelectorAll(".wp-block-miblocks-listing-section");console.log("Found blocks:",t.length),t.forEach((t=>{!function(t){const o=t.querySelectorAll(".filter-checkbox__input"),n=t.querySelectorAll(".filter-range__input"),a=t.querySelector(".cards-container");console.log("Filter checkboxes:",o.length),console.log("Range inputs:",n.length),a?(a.innerHTML,o.forEach((o=>{o.addEventListener("change",(()=>{console.log("Filter changed:",o.dataset.taxonomy,o.dataset.term),e(t)}))})),n.forEach((o=>{o.addEventListener("input",(e=>{const t=o.closest(".filter-range").querySelector(".filter-range__value span");t&&(t.textContent=e.target.value)})),o.addEventListener("change",(()=>{console.log("Range changed:",o.dataset.range,o.value),e(t)}))}))):console.error("Cards container not found")}(t)}))}))})();